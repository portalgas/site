<?php$this->Html->addCrumb(__('Home'), ['controller' => 'Pages', 'action' => 'home']);$this->Html->addCrumb(__('Statitics'));echo $this->Html->getCrumbList(array('class'=>'crumbs'));echo $this->Html->script('d3/d3.min');echo $this->Html->script('d3/d3pie.min');echo $this->Html->script('d3/d3.tip.v0.6.3');echo $this->Html->script('d3/myGrafics');	?><script type="text/javascript">var debugLocal = false;var tabActive = 0;var tabPrevious = 0;$(document).ready(function() {	<?php 	if(!empty($stat_delivery_id) || !empty($supplier_organization_id)) {		echo 'AjaxCallToOrders('.$stat_delivery_id.','.$supplier_organization_id.');';	}	?>		$('.nav-tabs a').on('shown.bs.tab', function(event){		tabActive = $(event.target).text();         // active tab		tabPrevious = $(event.relatedTarget).text();  // previous tab	}); });function choiceYear() {	var mese_da = $('#StatisticMeseDaMonth').val();	var anno_da = $('#StatisticAnnoDaYear').val();	var mese_a = $('#StatisticMeseAMonth').val();	var anno_a = $('#StatisticAnnoAYear').val();		AjaxCallToDeliveries(mese_da, anno_da, mese_a, anno_a); /* chiamata Ajax per elenco consegne */		}function choiceDeliveries() {	var div_contenitore = $('#stat_delivery_id').parent().parent().attr('id'); /* stat_delivery */ 		stat_delivery_id = $('#stat_delivery_id').val();	supplier_organization_id = $('#supplier_organization_id').val();	if(debugLocal) alert("choiceDeliveries - div_contenitore "+div_contenitore+", stat_delivery_id "+stat_delivery_id+" - supplier_organization_id "+supplier_organization_id);	elaboraTabs();	if(stat_delivery_id=='' && supplier_organization_id=='') {		$('#stat_orders_result').css('display','none');		return;	}			showHideBox(div_contenitore,call_child=true);	AjaxCallToOrders(stat_delivery_id, supplier_organization_id); /* chiamata Ajax per elenco ordini */	}function choiceSuppliersOrganization() {	var div_contenitore = 'supplier_organization'; /* $('#supplier_organization_id').parent().parent().attr('id'); */ 		stat_delivery_id = $('#stat_delivery_id').val();	supplier_organization_id = $('#supplier_organization_id').val();	if(debugLocal) alert("choiceSuppliersOrganization - div_contenitore "+div_contenitore+", stat_delivery_id "+stat_delivery_id+" - supplier_organization_id "+supplier_organization_id);	elaboraTabs();	if(stat_delivery_id=='' && supplier_organization_id=='') {		$('#stat_orders_result').css('display','none');		return;	}		showHideBox(div_contenitore,call_child=true);	AjaxCallToOrders(stat_delivery_id, supplier_organization_id); /* chiamata Ajax per elenco ordini */	}function AjaxCallToOrders(stat_delivery_id, supplier_organization_id) {	if(stat_delivery_id==0 && supplier_organization_id==0) return false;	var url = "/administrator/index.php?option=com_cake&controller=Statistics&action=box_stat_orders&stat_delivery_id="+stat_delivery_id+"&supplier_organization_id="+supplier_organization_id+"&format=notmpl";	var idDivTarget = 'stat_orders_result';	ajaxCallBox(url, idDivTarget);}function AjaxCallToDeliveries(mese_da, anno_da, mese_a, anno_a) {	var url = "/administrator/index.php?option=com_cake&controller=Statistics&action=box_stat_deliveries&mese_da="+mese_da+"&anno_da="+anno_da+"&mese_a="+mese_a+"&anno_a="+anno_a+"&format=notmpl";	var idDivTarget = 'stat_deliveries_results';	ajaxCallBox(url, idDivTarget);}function elaboraTabs() {	var action = 'tab_deliveries';		switch(tabActive) {	    case 0:	        action = 'tab_deliveries';	        break;	    case 1:	        action = 'tab_orders';	        break;	    case 2:	        action = 'tab_suppliers';	        break;	    case 3:	        action = 'tab_users';	        break;	    case 4:	        action = 'tab_users_details';	        break;	    case 5:	        action = 'tab_articles_orders';	        break; 	} 	idDivTarget = 'tabs-'+tabActive;		AjaxCallStatistic (action, idDivTarget);}</script>		<style type="text/css">/* style to grafic bars */.bar {  fill: steelblue;}.bar:hover {  fill: brown;}.axis {  font: 10px sans-serif;}.axis path,.axis line {  fill: none;  stroke: #000;  shape-rendering: crispEdges;}.x.axis path {  display: none;}.d3-tip {  line-height: 1;  font-weight: bold;  padding: 12px;  background: rgba(0, 0, 0, 0.8);  color: #fff;  border-radius: 2px;}/* Creates a small triangle extender for the tooltip */.d3-tip:after {  box-sizing: border-box;  display: inline;  font-size: 10px;  width: 100%;  line-height: 1;  color: rgba(0, 0, 0, 0.8);  content: "\25BC";  position: absolute;  text-align: center;}/* Style northward tooltips differently */.d3-tip.n:after {  margin: -1px 0 0 0;  top: 100%;  left: 0;}</style><div class="statistic">		<h2 class="ico-statistic">		<?php echo __('Statistics');?>	</h2>	<?php 	echo $this->element('legendaStatistics');		echo $this->Form->create('Statistic',array('id'=>'formGasFilter'));?>		<fieldset class="filter">			<legend><?php echo __('Filter Statistic'); ?></legend>				<div class="row">			  <div class="col-md-3">				<?php				echo $this->Form->label('Dal periodo');				echo $this->Form->month('mese_da', array('value' => $mese_da, 'empty' => false, 'onChange' => 'javascript:choiceYear();', 'class' => 'form-control'));				?>			  			  </div>			  <div class="col-md-3">				<?php				echo $this->Form->label('&nbsp;');				echo $this->Form->year('anno_da', 2012, $anno_da, array('default' => $anno_da, 'empty' => false, 'onChange' => 'javascript:choiceYear();', 'class' => 'form-control'));				?>			  			  </div>			  <div class="col-md-3">				<?php				echo $this->Form->label('al periodo');				echo $this->Form->month('mese_a', array('value' => $mese_a, 'empty' => false, 'onChange' => 'javascript:choiceYear();', 'class' => 'form-control'));				?>			  			  </div>			  <div class="col-md-3">				<?php				echo $this->Form->label('&nbsp;');				echo $this->Form->year('anno_a', 2012, $anno_a, array('default' => $anno_a, 'empty' => false, 'onChange' => 'javascript:choiceYear();', 'class' => 'form-control'));				?>			  			  </div>			</div>					<div id="stat_deliveries_results"></div>		<div id="supplier_organization">		<?php			$options = array('id' => 'supplier_organization_id', 'label' => __('SuppliersOrganization'), 'options' => $suppliersOrganization, 'onChange' => 'javascript:choiceSuppliersOrganization(this);', 'empty' => Configure::read('option.empty'));			if(count($suppliersOrganization) > Configure::read('HtmlSelectWithSearchNum'))				$options += array('class'=> 'selectpicker', 'data-live-search' => true);			echo $this->Form->input('SuppliersOrganization', $options);		?>		</div>				<div id="stat_orders_result" style="display:block;"></div>		</fieldset><?php echo $this->Form->end(); 		echo '<div class="tabs">';		echo '<ul class="nav nav-tabs">'; // nav-tabs nav-pills		echo '<li class="tabsDelivery active"><a href="#tabs-0" data-toggle="tab" onClick="javascript:AjaxCallStatistic(\'tab_deliveries\', \'tabs-0\');">'.__('Deliveries').'</a></li>';		echo '<li><a class="tabsDelivery" href="#tabs-1" data-toggle="tab" onClick="javascript:AjaxCallStatistic(\'tab_orders\', \'tabs-1\');">'.__('Orders').'</a></li>';		echo '<li><a class="tabsDelivery" href="#tabs-2" data-toggle="tab" onClick="javascript:AjaxCallStatistic(\'tab_suppliers\', \'tabs-2\');">'.__('Suppliers').'</a></li>';		echo '<li style="float: right;"><a class="tabsDelivery" href="#tabs-3" data-toggle="tab" onClick="javascript:AjaxCallStatistic(\'tab_users\', \'tabs-3\');">'.__('Dettaglio utenti').'</a></li>';				echo '<li style="float: right;"><a class="tabsDelivery" href="#tabs-4" data-toggle="tab" onClick="javascript:AjaxCallStatistic(\'tab_users_details\', \'tabs-4\');">'.__('Users').'</a></li>';				echo '<li style="float: right;"><a class="tabsDelivery" href="#tabs-5" data-toggle="tab" onClick="javascript:AjaxCallStatistic(\'tab_articles_orders\', \'tabs-5\');">'.__('Articles').'</a></li>';					echo '</ul>';		echo '<div class="tab-content">';		echo '<div style="min-height:50px;overflow: auto;" class="tab-pane fade active in" id="tabs-0"></div>';		echo '<div style="min-height:50px;overflow: auto;" class="tab-pane fade" id="tabs-1"></div>';		echo '<div style="min-height:50px;overflow: auto;" class="tab-pane fade" id="tabs-2"></div>';		echo '<div style="min-height:50px;overflow: auto;" class="tab-pane fade" id="tabs-3"></div>';		echo '<div style="min-height:50px;overflow: auto;" class="tab-pane fade" id="tabs-4"></div>';		echo '<div style="min-height:50px;overflow: auto;" class="tab-pane fade" id="tabs-5"></div>';				echo '</div>'; // tab-content		echo '</div>';		/*		echo '<div id="tabs">';		echo ' <ul>';		echo ' <li><a href="#tabs-0" class="tabsDelivery" onClick="javascript:AjaxCallStatistic(\'tab_deliveries\', \'tabs-0\');">Consegne</a></li>';		echo ' <li><a href="#tabs-1" class="tabsDelivery" onClick="javascript:AjaxCallStatistic(\'tab_orders\', \'tabs-1\');">Ordini</a></li>';		echo ' <li><a href="#tabs-2" class="tabsDelivery" onClick="javascript:AjaxCallStatistic(\'tab_suppliers\', \'tabs-2\');">Produttori</a></li>';		echo ' <li style="float: right;"><a href="#tabs-3" class="tabsDelivery" onClick="javascript:AjaxCallStatistic(\'tab_users\', \'tabs-3\');">Utenti</a></li>';		echo ' <li style="float: right;"><a href="#tabs-4" class="tabsDelivery" onClick="javascript:AjaxCallStatistic(\'tab_users_details\', \'tabs-4\');"></a></li>';		echo ' <li style="float: right;"><a href="#tabs-5" class="tabsDelivery" onClick="javascript:AjaxCallStatistic(\'tab_articles_orders\', \'tabs-5\');">Articoli</a></li>';		echo '</ul>';				echo '<div style="min-height:50px;overflow: auto;" id="tabs-0"></div>';		echo '<div style="min-height:50px;overflow: auto;" id="tabs-1"></div>';		echo '<div style="min-height:50px;overflow: auto;" id="tabs-2"></div>';		echo '<div style="min-height:50px;overflow: auto;" id="tabs-3"></div>';		echo '<div style="min-height:50px;overflow: auto;" id="tabs-4"></div>';		echo '<div style="min-height:50px;overflow: auto;" id="tabs-5"></div>';		echo '</div>';		*/		echo '<div style="clear:both;"></div>';				echo '<div style="float:left;width:49%" id="pieChart"></div>';		echo '<div style="float:right;width:49%" id="pieBars"></div>';	?>			<script type="text/javascript">			function AjaxCallStatistic (action, idDivTarget) {								var stat_delivery_id = $('#stat_delivery_id').val();				if(stat_delivery_id==undefined) stat_delivery_id = 0;				var supplier_organization_id = $('#supplier_organization_id').val();				if(supplier_organization_id==undefined) supplier_organization_id = 0;				var stat_order_id = $('#stat_order_id').val();				if(stat_order_id==undefined) stat_order_id = 0;				var mese_da = $('#StatisticMeseDaMonth').val();				var anno_da = $('#StatisticAnnoDaYear').val();				var mese_a = $('#StatisticMeseAMonth').val();				var anno_a = $('#StatisticAnnoAYear').val();											var url = '/administrator/index.php?option=com_cake&controller=Statistics&action='+action+'&mese_da='+mese_da+'&anno_da='+anno_da+'&mese_a='+mese_a+'&anno_a='+anno_a+'&stat_delivery_id='+stat_delivery_id+'&supplier_organization_id='+supplier_organization_id+'&stat_order_id='+stat_order_id+'&format=notmpl';								// ajaxCallBox(url, idDivTarget);					var urlAjax = 'url("'+app_img+'/ajax-loader.gif") no-repeat scroll center 0 transparent'; 				$('#pieChart').html('');				$('#pieBars').html('');								$('#'+idDivTarget).html('');				$('#'+idDivTarget).css('background', urlAjax);								$.ajax({					type: "get", 					url: url,					data: "", 					success: function(response) {						$('#'+idDivTarget).css('background', 'none repeat scroll 0 0 transparent');						$('#'+idDivTarget).html(response);					},					error:function (XMLHttpRequest, textStatus, errorThrown) {						$('#'+idDivTarget).css('background', 'none repeat scroll 0 0 transparent');						$('#'+idDivTarget).html(textStatus);					},					complete: function(response) {						myGrafics();					},				});								}			$(document).ready(function() {				$('#tabs').tabs({event: "click"});								/* AjaxCallStatistic('tab_deliveries', 'tabs-0'); */								choiceYear();					elaboraTabs();			});			</script></div>