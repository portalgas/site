<?php $only_one_order = false;foreach($results as $result) {	echo $this->Tabs->messageDelivery($result['Delivery'], $user);		/*	 * elenco P R O D U T T O R I  con ordini da validare i colli (pezzi_confezione)	 */	if(!empty($result['Delivery']['OrderToValidate'])) {					echo '<div class="container" style="padding-left: 0px; margin-left: 0px; width: 100%; padding-bottom:5px;">';		echo '<div class="col-xs-12 col-md-12">';				echo '<form role="select" class="select-orders navbar-form" accept-charset="utf-8" method="get">';		echo '<select id="order_to_validate_'.$result['Delivery']['id'].'" name="order_to_validate_'.$result['Delivery']['id'].'" size="1" data-live-search="true" class="orders_select selectpicker dropup" data-width="100%">';		echo '<option value="">Seleziona il produttore per completare i colli</option>';		foreach($result['Delivery']['OrderToValidate'] as $orderResult) {			echo "\n";			if($orderResult['Order']['data_fine_validation']!=Configure::read('DB.field.date.empty'))				$data_fine_validation = $this->Time->i18nFormat($orderResult['Order']['data_fine_validation'],"%A %e %B %Y");			else				$data_fine_validation = "";							echo '<option value="'.$orderResult['Order']['id'].'">'.$orderResult['SuppliersOrganization']['name'];			if(!empty($orderResult['Supplier']['descrizione'])) echo '/'.$orderResult['Supplier']['descrizione'];			echo ' - ordine riaperto per completare i colli fino a '.$data_fine_validation.'</option>';		}		echo '</select>';		echo '</form>';					echo '</div>';			echo '</div>';  // class="container"		}		/*	 * elenco P R O D U T T O R I	*/	if(empty($result['Delivery']['Order'])) {				if(!empty($result['Delivery']['OrderToValidate'])) {			echo '<div class="articlesOrderResult" id="articlesOrderResult_'.$result['Delivery']['id'].'" style="min-height: 50px;"></div>';			echo $this->element('boxIntroHelpEcomm', array('id' => $result['Delivery']['id']));		} 		else {			$msg = "Non ci sono ordini aperti";				echo $this->element('boxMsgFrontEnd', array('class_msg' => 'notice', 'msg' => $msg));		}	}	else {		if(count($result['Delivery']['Order'])==1) 			$only_one_order = true;				echo '<div class="container" style="padding-left: 0px; margin-left: 0px; width: 100%; padding-bottom:5px;">';		echo '<div class="col-xs-12">';				echo '<form role="select" class="select-orders navbar-form" accept-charset="utf-8" method="get">';		echo '<select id="order_'.$result['Delivery']['id'].'" name="order_'.$result['Delivery']['id'].'" size="1" data-live-search="true" class="orders_select selectpicker dropup" data-width="auto">';		echo '<option value="">Seleziona il produttore</option>';		foreach($result['Delivery']['Order'] as $orderResult) {					echo "\n";			if($orderResult['Order']['data_fine']!=Configure::read('DB.field.date.empty'))				$data_fine = $this->Time->i18nFormat($orderResult['Order']['data_fine'],"%A %e %B %Y");			else				$data_fine = "";					echo '<option value="'.$orderResult['Order']['id'].'">'.$orderResult['SuppliersOrganization']['name'];			if(!empty($orderResult['Supplier']['descrizione'])) echo '/'.$orderResult['Supplier']['descrizione'];			echo ' - chiude il '.$data_fine.'</option>';		}		echo '</select>';		echo '</form>';		echo '</div>';			echo '</div>';	 // class="container"				echo '<div class="articlesOrderResult" id="articlesOrderResult_'.$result['Delivery']['id'].'" style="min-height: 50px;"></div>';				echo $this->element('boxIntroHelpEcomm', array('id' => $result['Delivery']['id']));	}?><script type="text/javascript">var select_order = false;var select_order_to_validate = false;var debug = false;jQuery(document).ready(function() {	jQuery('#order_<?php echo $result['Delivery']['id'];?>').change(function() {		   if(debug) console.log('DeliveryId <?php echo $result['Delivery']['id'];?>'); 		   jQuery("#order_<?php echo $result['Delivery']['id'];?> option:selected").each(function () {			    getArticlesOrders_<?php echo $result['Delivery']['id'];?>(<?php echo $result['Delivery']['id'];?>, this);		   });	});    	jQuery('#order_to_validate_<?php echo $result['Delivery']['id'];?>').change(function() {		   jQuery("#order_to_validate_<?php echo $result['Delivery']['id'];?> option:selected").each(function () {		         var orderId = jQuery(this).val();		         if(orderId!="") {		        	 select_order = false;		        	 select_order_to_validate = true;		        	 if(jQuery('#order_<?php echo $result['Delivery']['id'];?>').length>0) {			        	 jQuery('#order_<?php echo $result['Delivery']['id'];?> option:first-child').prop('selected', true);						 jQuery('#order_<?php echo $result['Delivery']['id'];?>').selectpicker('refresh');		        	 }					 					 jQuery('.introHelp').css('display', 'none');					 jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').css('display', 'block');					 jQuery('.articlesOrderResult').html('');					 jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').css('min-height','100');					 jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').css('background', 'url("/images/cake/ajax-loader.gif") no-repeat scroll center 0 transparent');					 					 url = "/?option=com_cake&controller=Deliveries&action=tabsAjaxEcommCartsValidation&delivery_id=<?php echo $result['Delivery']['id'];?>&order_id="+orderId+"&a=&b=&format=notmpl";					 					 jQuery.ajax({						type: "GET",						url: url,						data: "",						success: function(response){							jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').css('background', 'none repeat scroll 0 0 transparent');							jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').html(response);						},						error:function (XMLHttpRequest, textStatus, errorThrown) {							jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').css('background', 'none repeat scroll 0 0 transparent');							jQuery('#articlesOrderResult_<?php echo $result['Delivery']['id'];?>').html(textStatus);						}				 	 });				 }				 else {					 if(!select_order) {						 jQuery('.articlesOrderResult').css('display', 'none');						 jQuery('.articlesOrderResult').html('');						 jQuery('#introHelp_<?php echo $result['Delivery']['id'];?>').css('display', 'block');					 }				 }		   });	});    	<?php 	/*	 *  solo se ho una consegna per quella data	 */	if($only_one_order) {	?>		if(jQuery('.orders_select').length==1) {			jQuery('#order_<?php echo $result['Delivery']['id'];?>').find('option:eq(1)').prop('selected', true);			jQuery('#order_<?php echo $result['Delivery']['id'];?>').selectpicker('refresh');					getArticlesOrders_<?php echo $result['Delivery']['id'];?>(<?php echo $result['Delivery']['id'];?>, jQuery('#order_<?php echo $result['Delivery']['id'];?>'));		}	<?php 	}	?>	});function getArticlesOrders_<?php echo $result['Delivery']['id'];?>(deliverId, obj) {		        var orderId = jQuery(obj).val();	if(debug) console.log('orderId '+orderId);	if(debug) console.log('deliverId '+deliverId);	    if(orderId!="") {   	 select_order = true;   	 select_order_to_validate = false;   	 if(jQuery('#order_to_validate_'+deliverId).length>0) {       	 jQuery('#order_to_validate_'+deliverId+' option:first-child').prop('selected', true);		 jQuery('#order_to_validate_'+deliverId).selectpicker('refresh');	 }	 		 jQuery('.introHelp').css('display', 'none');		 jQuery('#articlesOrderResult_'+deliverId).css('display', 'block');		 jQuery('.articlesOrderResult').html('');		 jQuery('#articlesOrderResult_'+deliverId).css('min-height','100');		 jQuery('#articlesOrderResult_'+deliverId).css('background', 'url("/images/cake/ajax-loader.gif") no-repeat scroll center 0 transparent');		 		 url = "/?option=com_cake&controller=Deliveries&action=tabsAjaxEcommArticlesOrder&delivery_id="+deliverId+"&order_id="+orderId+"&a=&b=&c=&format=notmpl";		 if(debug) console.log('ecomm_deliveries '+url);		 		 jQuery.ajax({			type: "GET",			url: url,			data: "",			success: function(response){				jQuery('#articlesOrderResult_'+deliverId).css('background', 'none repeat scroll 0 0 transparent');				jQuery('#articlesOrderResult_'+deliverId).html(response);			},			error:function (XMLHttpRequest, textStatus, errorThrown) {				jQuery('#articlesOrderResult_'+deliverId).css('background', 'none repeat scroll 0 0 transparent');				jQuery('#articlesOrderResult_'+deliverId).html(textStatus);			}	 	 });	 }	 else {		 if(select_order_to_validate) {			 jQuery('.articlesOrderResult').css('display', 'none');			 jQuery('.articlesOrderResult').html('');			 jQuery('#introHelp_'+deliverId).css('display', 'block');		 }	 }}</script><script type="text/javascript">jQuery(document).ready(function() {	jQuery('.selectpicker').selectpicker({		style: 'selectpicker selectpicker-my'	});	jQuery('a').tooltip();		jQuery('#slideshow_<?php echo $orderResult['Order']['id'];?>').carousel({		interval: false	}) });</script><?php}?></form>