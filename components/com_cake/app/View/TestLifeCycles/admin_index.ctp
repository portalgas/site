<?php$this->App->d($orderResults);if($user->organization['Template']['payToDelivery'] == 'POST' || $user->organization['Template']['payToDelivery']=='ON-POST') 	$colspan = '15';else	$colspan = '14';	$this->Html->addCrumb(__('Home'), ['controller' => 'Pages', 'action' => 'home']);$this->Html->addCrumb(__('TestLifeCycles'));echo $this->Html->getCrumbList(['class'=>'crumbs']);echo '<div class="mails">';echo '<h2 class="ico-config">';echo __('TestLifeCycles');echo '</h2>';echo '</div>';/* * G A S  */ echo '<div class="table-responsive"><table class="table">';echo '<tr>';echo '<th colspan="2">'.__('Name').'</th>';echo '<th>'.__('template').'</th>';echo '<th>'.__('PayToDelivery').'</th>';echo '<th>'.__('orderForceClose').'</th>';echo '<th>'.__('orderUserPaid').'</th>';echo '<th>'.__('orderSupplierPaid').'</th>';echo '<th>'.__('CashLimit').'</th>';echo '<th>'.__('LimitCashAfterShort').'</th>';echo '<th>'.__('HasDesShort').'</th>';echo '</tr>';	echo '<tr valign="top">';echo '<td>';echo ' <img width="50" class="img-responsive-disabled userAvatar" src="'.Configure::read('App.web.img.upload.content').'/'.$organizationResults['Organization']['img1'].'" alt="'.$organizationResults['Organization']['name'].'" /> ';	echo '</td>';		echo '<td>';echo $organizationResults['Organization']['name']; echo '</td>';echo '<td>';echo $organizationResults['Template']['name'].' ('.$organizationResults['Organization']['template_id'].')';echo '</td>';echo '<td>';echo $organizationResults['Template']['payToDelivery'];echo '</td>';echo '<td class="stato_'.$this->App->traslateEnum($organizationResults['Template']['orderForceClose']).'_int"></td>';echo '<td class="stato_'.$this->App->traslateEnum($organizationResults['Template']['orderUserPaid']).'_int"></td>';echo '<td class="stato_'.$this->App->traslateEnum($organizationResults['Template']['orderSupplierPaid']).'_int"></td>';echo '<td>';echo __($organizationResults['Organization']['cashLimit']);echo '</td>';echo '<td>';echo $organizationResults['Organization']['limitCashAfter'];echo '</td>';echo '<td class="stato_'.$this->App->traslateEnum($organizationResults['Organization']['hasDes']).'_int"></td>';echo '</table></div>';/* * L I S T   O R D E R S */	echo $this->Form->create('FilterTestLifeCycle',array('id'=>'formGasFilter','type'=>'get'));echo '<fieldset class="filter">';echo '<legend>'.__('Filter TestLifeCycle').'</legend>';		$options = ['id' => 'order_id', 				 'data-placeholder' => 'Scegli un ordine',				 'options' => $orderListResults, 				 'name'=>'FilterTestLifeCycleOrderId', 				 'default' => $FilterTestLifeCycleOrderId, 				 'empty' => Configure::read('option.empty'), 				 'escape' => false];if(!$browsers['ie11'] && count($orderListResults) > Configure::read('HtmlSelectWithSearchNum')) 	$options += ['class'=> 'selectpicker', 'data-live-search' => true]; if(empty($FilterTestLifeCycleOrderId))	$options += ['empty' => Configure::read('option.empty')];echo '<div class="row">';echo '<div class="col-md-5">';echo $this->Form->input('order_id', $options);echo '</div>';echo '<div class="col-md-3">';if($user->organization['Template']['payToDelivery'] == 'POST' || $user->organization['Template']['payToDelivery']=='ON-POST') {		$options = ['id' => 'request_payment_id', 						 'data-placeholder' => 'Scegli un richiesta di pagamento',						 'options' => $requestPaymentResults, 						 'name'=>'FilterTestLifeCycleRequestPaymentId', 						 'default' => $FilterTestLifeCycleRequestPaymentId, 						 'empty' => Configure::read('option.empty'), 						// 'label' => __('RequestPayment'), 						 'escape' => false];		if(!$browsers['ie11'] && count($requestPaymentResults) > Configure::read('HtmlSelectWithSearchNum')) 			$options += ['class'=> 'selectpicker', 'data-live-search' => true]; 		if(empty($requestPaymentResults))			$options += ['empty' => Configure::read('option.empty')];	echo $this->Form->input('request_payment_id', $options);}echo '</div>';echo '<div class="col-md-2">';echo $this->Form->input('stato',array('label' => __('Stato'), 'class' => 'form-control', 'options' => $order_state_codes,'name'=>'FilterTestLifeCycleOrderStateCode','default'=>$FilterTestLifeCycleOrderStateCode,'escape' => false)); echo '</div>';echo '<div class="col-md-2">';	echo $this->Form->end(array('label' => __('Filter'), 'class' => 'filter', 'div' => array('class' => 'submit filter', 'style' => 'display:none'))); echo '</div>';		echo '</div>';	echo '</fieldset>';/* * O R D E R S */		if(!empty($orderResults)) {		echo '<div class="table-responsive"><table class="table table-hover">';		echo '<tr>';		echo '	<th colspan="3">'.__('SuppliersOrganization').'</th>';		echo '	<th>'.__('organization_owner_articles_short').'</th>';		echo '	<th>'.__('OpenClose').'</th>';		echo '  <th>'.__('StatoElaborazione').'</th>';		echo '  <th>'.__('OrderTypeGestShort').'</th>';		echo '  <th>'.__('HasTrasportShort').'</th>';		echo '  <th>'.__('HasCostMoreShort').'</th>';		echo '  <th>'.__('HasCostLessShort').'</th>';		echo '  <th>'.__('HasDesShort').'</th>';		if($user->organization['Template']['payToDelivery'] == 'POST' || $user->organization['Template']['payToDelivery']=='ON-POST')			echo '  <th>'.__('request_payment_num_short').'</th>';		echo '  <th>'.__('isPaidSupplier').'</th>';		echo '  <th></th>';		echo '	<th class="actions" style="min-width: 125px;">'.__('Actions').'</th>';		echo '</tr>';				$delivery_id_old = 0;		foreach ($orderResults as  $result) {								$this->App->d($result); 						if($delivery_id_old==0 || $delivery_id_old!=$result['Delivery']['id']) {								echo '<tr><td class="trGroup" colspan="'.$colspan.'">';								if($result['Delivery']['sys']=='N') {					echo '<span >'.__('Delivery').': </span>'.$result['Delivery']['luogoData'];					echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';					if($result['Delivery']['daysToEndConsegna']<0) {						echo '<span style="color:red;">Chiusa</span>';					}					else {						echo '<span style="color:green;">Aperta ';						if($result['Delivery']['daysToEndConsegna']==0) echo '(scade oggi)';						else echo '(mancano ancora '.$result['Delivery']['daysToEndConsegna'].'&nbsp;gg&nbsp;alla&nbsp;consegna)';						echo '</span>';					}				}				else {					echo '<span >'.__('Delivery').': </span>'.h($result['Delivery']['luogo']);				}				echo '</td></tr>';			}						echo '<tr>';		echo '<td class="hidden-xs hidden-sm">';		echo '<a data-toggle="collapse" href="#ajax_details-'.$result['Order']['id'].'" title="'.__('Href_title_expand').'"><i class="fa fa-3x fa-search-plus" aria-hidden="true"></i></a>';		echo '</td>';				echo '	<td>';		if(!empty($result['Supplier']['img1']) && file_exists(Configure::read('App.root').Configure::read('App.img.upload.content').'/'.$result['Supplier']['img1']))			echo ' <img width="50" class="img-responsive-disabled" src="'.Configure::read('App.web.img.upload.content').'/'.$result['Supplier']['img1'].'" alt="'.$result['SupplierOrganization']['name'].'" /> ';		echo '	</td>';		echo '	<td>';		echo $result['SuppliersOrganization']['name'];		if($user->organization['Organization']['hasDes']=='Y' && !empty($result['DesOrdersOrganization'])) {			if($result['DesOrdersOrganization']['des_id']==$user->des_id) 				echo '<span class="ico-order-is-des" title="'.__('OrderIsDes').'"></span>';		}		else {			if($result['Order']['prod_gas_promotion_id']>0)				echo '<span class="ico-order-is-prod_gas_promotion" title="'.__('OrderIsProdGasPromotion').'"></span>';		}		echo '	</td>';		echo '<td>';		echo $this->App->traslateEnum('ProdGasSupplier'.$result['Order']['owner_articles']);		if($result['Order']['owner_articles']!=$result['SuppliersOrganization']['owner_articles'])			echo '<div class="alert alert-warning"><strong>Il produttore è</strong> '.$this->App->traslateEnum('ProdGasSupplier'.$result['SuppliersOrganization']['owner_articles']).'</div>';		echo '</td>';							echo '	<td style="white-space:nowrap;" >';		echo $this->App->utilsCommons->getOrderTime($result['Order']);		echo '	</td>';					echo '<td >';		echo $this->App->drawOrdersStateDiv($result);		echo '&nbsp;';	    echo __($result['Order']['state_code'].'-label');		echo '</td>';		switch($result['Order']['typeGest']) {			case 'AGGREGATE':				$typeGest = 'Aggregati';			break;			case 'SPLIT':				$typeGest = 'Suddivisi';			break;			default:				$typeGest = '---';			break;		}		echo '<td>'.$typeGest.'</td>';				if($result['Order']['hasTrasport']=='Y')			echo '<td>'.$result['Order']['trasport_e'].'</td>';		else			echo '<td class="stato_'.$this->App->traslateEnum($result['Order']['hasTrasport']).'_int"></td>';		if($result['Order']['hasCostMore']=='Y')			echo '<td>'.$result['Order']['cost_more_e'].'</td>';		else			echo '<td class="stato_'.$this->App->traslateEnum($result['Order']['hasCostMore']).'_int"></td>';		if($result['Order']['hasCostLess']=='Y')			echo '<td>'.$result['Order']['cost_less_e'].'</td>';		else			echo '<td class="stato_'.$this->App->traslateEnum($result['Order']['hasCostLess']).'_int"></td>';				if($user->organization['Organization']['hasDes']=='Y' && !empty($result['DesOrdersOrganization'])) 			echo '<td>'.$result['DesOrdersOrganization']['des_id'].'</td>';		else			echo '<td class="stato_no_int"></td>';				if($user->organization['Template']['payToDelivery'] == 'POST' || $user->organization['Template']['payToDelivery']=='ON-POST')  {			echo '<td>';			echo $result['Order']['request_payment_num'];			echo '</td>';		}		echo '<td title="Order.tesoriere_stato_pay=Y" class="stato_'.$this->App->traslateEnum($result['isPaidSupplier']).'_int"></td>';				/*		 * btns / msg		 */		echo '<td style="white-space: nowrap;">';				/*		 * annullo pagamenti		 */		echo $this->App->drawOrderStateBackProcessedTesoriere($user, $result);				$btns = $this->App->drawOrderBtnPaid($result, $isRoot, $isTesoriereGeneric);		if(!empty($btns))			echo $btns;			else if(!empty($result['Order']['msgGgArchiveStatics']))			echo $this->App->drawOrderMsgGgArchiveStatics($result);				echo $this->App->drawOrderStateNext($result);		echo '</td>';				echo '<td>';			if($result['Order']['can_state_code_to_close'])			echo '<a title="'.__('Close Order').'"  href="'.Configure::read('App.server').'/administrator/index.php?option=com_cake&controller=Orders&action=close&delivery_id='.$result['Order']['delivery_id'].'&order_id='.$result['Order']['id'].'"><button type="button" class="btn btn-danger"><i class="fa fa-2x fa-power-off" aria-hidden="true"></i></button></a>';				echo '<a title="'.__('Order home').'"  href="'.Configure::read('App.server').'/administrator/index.php?option=com_cake&controller=Orders&action=home&delivery_id='.$result['Order']['delivery_id'].'&order_id='.$result['Order']['id'].'"><button type="button" class="btn btn-primary"><i class="fa fa-2x fa-home" aria-hidden="true"></i></button></a>';					$modal_url = Configure::read('App.server').'/administrator/index.php?option=com_cake&controller=Orders&action=sotto_menu&order_id='.$result['Order']['id'].'&position_img=bgLeft&format=notmpl';		$modal_size = 'md'; // sm md lg		$modal_header = __('Order').' '.$result['SuppliersOrganization']['name'];		echo '<button type="button" class="btn btn-primary btn-menu" data-attr-url="'.$modal_url.'" data-attr-size="'.$modal_size.'" data-attr-header="'.$modal_header.'" ><i class="fa fa-2x fa-navicon"></i></button>';				echo '</td>';			echo '</tr>';		echo '<tr data-attr-action="summary_orders-'.$result['Order']['id'].'" class="collapse ajax_details" id="ajax_details-'.$result['Order']['id'].'">';		echo '	<td colspan="2"></td>'; 		echo '	<td colspan="'.($colspan-2).'" id="ajax_details_content-'.$result['Order']['id'].'"></td>';		echo '</tr>';			$delivery_id_old=$result['Delivery']['id'];	} 		echo '</table></div>'; } // end if(!empty($orderResults))	if(($user->organization['Template']['payToDelivery'] == 'POST' || $user->organization['Template']['payToDelivery']=='ON-POST') && !empty($FilterTestLifeCycleRequestPaymentId)) {	echo '<div class="clearfix"></div>';	include(__DIR__.'/../RequestPayments/box_detail.ctp');		if(!empty($results['SummaryPayment'])) {		echo '<h2>SummaryPayment: dati aggregati per gasista per richiesta di pagamento (può includere ordini + dispensa + voci di spesa)';		echo '<div class="table-responsive"><table class="table table-hover">';		echo '<tr>';		echo '	<th>'.__('Name').'</th>';		echo '	<th>'.__('Importo_dovuto').'</th>';		echo '	<th>'.__('Importo_richiesto').'</th>';		echo '  <th>'.__('Importo_pagato').'</th>';		echo '  <th>'.__('stato').'</th>';		echo '</tr>';				$importo_dovuto_tot = 0;		$importo_richiesto_tot = 0;		$importo_pagato_tot = 0;		foreach ($results['SummaryPayment'] as  $summaryPayment) {			echo '<tr>';			echo '	<td title="'.$summaryPayment['User']['id'].'">'.$summaryPayment['User']['name'].'</td>';			echo '	<td>'.$summaryPayment['SummaryPayment']['importo_dovuto_e'].'</td>';			echo '	<td>'.$summaryPayment['SummaryPayment']['importo_richiesto_e'].'</td>';			echo '	<td>'.$summaryPayment['SummaryPayment']['importo_pagato_e'].'</td>';			echo '	<td>'.$summaryPayment['SummaryPayment']['stato'].'</td>';			echo '</tr>';				$importo_dovuto_tot += $summaryPayment['SummaryPayment']['importo_dovuto'];			$importo_richiesto_tot += $summaryPayment['SummaryPayment']['importo_richiesto'];			$importo_pagato_tot += $summaryPayment['SummaryPayment']['importo_pagato'];					} 				$importo_dovuto_tot = number_format($importo_dovuto_tot,2,Configure::read('separatoreDecimali'),Configure::read('separatoreMigliaia'));		$importo_richiesto_tot = number_format($importo_richiesto_tot,2,Configure::read('separatoreDecimali'),Configure::read('separatoreMigliaia'));		$importo_pagato_tot = number_format($importo_pagato_tot,2,Configure::read('separatoreDecimali'),Configure::read('separatoreMigliaia'));					echo '<tr>';		echo '	<th>'.__('Total').'</th>';		echo '	<th>'.$importo_dovuto_tot.'</th>';		echo '	<th>'.$importo_richiesto_tot.'</th>';		echo '  <th>'.$importo_pagato_tot.'</th>';		echo '  <th></th>';		echo '</tr>';				echo '</table></div>'; 			} // end if(!empty($results['SummaryPayment']))}echo $this->App->drawLegenda($user, $orderStatesToLegenda);?><script type="text/javascript">$(document).ready(function() {	<?php	if(!empty($FilterTestLifeCycleOrderId)) {?>		$('a[href="#ajax_details-<?php echo $FilterTestLifeCycleOrderId;?>"]').trigger('click');	<?php	}	?>});</script>