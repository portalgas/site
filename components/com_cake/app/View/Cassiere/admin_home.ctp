<?php$this->Html->addCrumb(__('Home'),array('controller' => 'Pages', 'action' => 'home'));$this->Html->addCrumb(__('Cassiere home'));echo $this->Html->getCrumbList(array('class'=>'crumbs'));?><div class="cassiere">	<h2 class="ico-users">		<?php echo __('Cassiere');?>	</h2></div><?phpif($isCassiere) {		/*	 *  consegne con TUTTI gli ordini a CLOSE	 */	if(!empty($allOrdersCloseResults)) {			echo $this->element('legendaCassiereDeliveriesToClose', array('OrganizationHasUserGroupsReferentTesoriere' => $user->organization['Organization']['hasUserGroupsReferentTesoriere']));	?>		<table cellpadding="0" cellspacing="0">		<tr>			<th></th>			<th><?php echo __('N');?></th>			<th><?php echo __('luogo');?></th>			<th><?php echo __('data');?></th>			<th><?php echo __('Aperto/Chiuso');?></th>			<?php 			if($user->organization['Organization']['hasStoreroom']=='Y' && $user->organization['Organization']['hasStoreroomFrontEnd']=='Y') {				echo '<th>'.__('Dispensa').'</th>';				echo '<th>Dispensa<br />rich. pagam.</th>';			}						if($user->organization['Organization']['hasVisibility']=='Y') {				echo '<th>'.__('isVisibleFrontEnd').'</th>';				echo '<th>'.__('isVisibleBackOffice').'</th>';			}			?>			<th><?php echo __('stato_elaborazione');?></th>			<th class="actions"><?php echo __('Actions');?></th>	</tr>	<?php	foreach ($allOrdersCloseResults as $numResult => $result) {?>	<tr class="view">		<td><a action="deliveries-<?php echo $result['Delivery']['id']; ?>" class="actionTrView openTrView" href="#" title="<?php echo __('Href_title_expand');?>"></a></td>		<td><?php echo ($numResult+1);?></td>		<td><?php echo $result['Delivery']['luogo'];?></td>		<td style="white-space:nowrap;"><?php echo $this->Time->i18nFormat($result['Delivery']['data'],"%A %e %B %Y"); ?></td>		<td>			<?php 			if($result['Delivery']['daysToEndConsegna']<0) 				echo '<span style="color:red;">Chiuso</span>';			else {					echo '<span style="color:green;">Aperto ';					if($result['Delivery']['daysToEndConsegna']==0) echo '(scade oggi)';					else echo '(per ancora '.$result['Delivery']['daysToEndConsegna'].'&nbsp;gg)';					echo '</span>';			}					echo '</td>';					if($user->organization['Organization']['hasStoreroom']=='Y' && $user->organization['Organization']['hasStoreroomFrontEnd']=='Y') {			echo '<td title="'.__('toolTipIsToStoreroom').'" class="stato_'.$this->App->traslateEnum($result['Delivery']['isToStoreroom']).'"></td>';			echo '<td title="'.__('toolTipIsToStoreroomPay').'" class="stato_'.$this->App->traslateEnum($result['Delivery']['isToStoreroomPay']).'"></td>';		}				if($user->organization['Organization']['hasVisibility']=='Y') {			echo '<td title="'.__('toolTipsVisibleFrontEnd').'" class="stato_'.$this->App->traslateEnum($result['Delivery']['isVisibleFrontEnd']).'"></td>';			echo '<td title="'.__('toolTipVisibleBackOffice').'" class="stato_'.$this->App->traslateEnum($result['Delivery']['isVisibleBackOffice']).'"></td>';				}		?>			<td title="<?php echo __('toolTipStatoElaborazione');?>" class="stato_<?php echo strtolower($result['Delivery']['stato_elaborazione']); ?>"></td>		<td class="actions-table-img">			<?php echo $this->Html->link(null, array('action' => 'edit_stato_elaborazione', $result['Delivery']['id']), array('class' => 'action actionOpen actionDeliveryOpen','title' => __('Edit Stato Elaborazione'))); ?>		</td>	</tr>	<tr class="trView" id="trViewId-<?php echo $result['Delivery']['id'];?>">		<td colspan="2"></td>		<td colspan="5" id="tdViewId-<?php echo $result['Delivery']['id'];?>"></td>	</tr>	<?php } // loop allOrdersNOTCloseResults		echo '</table>';	} // end if(!empty($allOrdersCloseResults))	/*	 *  consegne con gli ordini NON tutti a CLOSE	 *	quelli in PROCESSED-ON-DELIVERY (in carico al cassiere durante la consegna) li posso passare a CLOSE	 */	if(!empty($allOrdersNOTCloseResults)) {echo '<hr>';			echo '<table cellpadding="0" cellspacing="0">';			echo '<tr>';			echo '	<th></th>';			echo '	<th>'.__('N').'</th>';			echo '	<th>'.__('Suppliers').'</th>';			echo '	<th>';			echo 		__('Data inizio');			echo '		<br />';			echo 		__('Data fine');			echo '	</th>';			echo '	<th>'.__('Aperto/Chiuso').'</th>';			echo '<th>'.__('stato_elaborazione').'</th>';			echo '	<th class="actions">'.__('Actions').'</th>';			echo '</tr>';						$delivery_id_old = 0;			foreach ($allOrdersNOTCloseResults as $i => $result):				if($delivery_id_old==0 || $delivery_id_old!=$result['Delivery']['id']) {										echo '<tr><td class="trGroup" colspan="12">';										if($result['Delivery']['sys']=='N') {						if($delivery_link_permission)							echo __('Delivery').': '.$this->Html->link($result['Delivery']['luogoData'], array('controller' => 'deliveries', 'action' => 'edit', null, 'delivery_id='.$result['Delivery']['id']),array('title'=>__('Edit Delivery')));						else							echo __('Delivery').': '.$result['Delivery']['luogoData'];						echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';						if($result['Delivery']['daysToEndConsegna']<0) {							echo '<span style="color:red;">Chiusa</span>';						}						else {							echo '<span style="color:green;">Aperta ';							if($result['Delivery']['daysToEndConsegna']==0) echo '(scade oggi)';							else echo '(mancano ancora '.$result['Delivery']['daysToEndConsegna'].'&nbsp;gg&nbsp;alla&nbsp;consegna)';							echo '</span>';						}					}					else {						echo __('Delivery').': '.h($result['Delivery']['luogo']);					}					echo '</td></tr>';				}							echo '<tr class="view">';			echo '	<td>'.($i+1).'</td>';			echo '	<td>';			if(!empty($result['Supplier']['img1']) && file_exists(Configure::read('App.root').Configure::read('App.img.upload.content').'/'.$result['Supplier']['img1']))				echo ' <img width="50" class="userAvatar" src="'.Configure::read('App.web.img.upload.content').'/'.$result['Supplier']['img1'].'" alt="'.$result['SupplierOrganization']['name'].'" /> ';			echo '	</td>';			echo '	<td>';								echo $result['SuppliersOrganization']['name'];						echo '	</td>';			echo '	<td style="white-space:nowrap;">';			echo $this->Time->i18nFormat($result['Order']['data_inizio'],"%A %e %B %Y").'<br />';			echo $this->Time->i18nFormat($result['Order']['data_fine'],"%A %e %B %Y");			if($result['Order']['data_fine_validation']!=Configure::read('DB.field.date.empty'))				echo '<br />Riaperto fino a '.$this->Time->i18nFormat($result['Order']['data_fine_validation'],"%A %e %B %Y");			echo '	</td>';			echo '	<td style="white-space:nowrap;">';			echo $this->App->utilsCommons->getOrderTime($result['Order']);			echo '	</td>';			echo '<td>';		 			echo $this->App->drawOrdersStateDiv($result);			echo '&nbsp;';			echo __($result['Order']['state_code'].'-label');			echo '</td>';						echo '<td class="actions-table-img">';			if($result['Order']['state_code']=='PROCESSED-ON-DELIVERY')				echo $this->Html->link(null, array('action' => 'edit_order_stato_elaborazione', $result['Order']['id']), array('class' => 'action actionOpen actionOrderOpen','title' => __('Edit Stato Elaborazione')));			else			if($result['Order']['state_code']!='CLOSE')				echo "*";			echo '</td>';			echo '</tr>';						$delivery_id_old=$result['Delivery']['id'];		endforeach; // loop allOrdersNOTCloseResults		echo '</table>';		echo $this->element('legendaCassiereOrdersToClose');	} // end if(!empty($allOrdersNOTCloseResults))		if(empty($allOrdersCloseResults) && empty($allOrdersNOTCloseResults))  		echo $this->element('boxMsg',array('class_msg' => 'message resultsNotFonud', 'msg' => "Non ci sono ancora consegne che si possono chiudere"));		?>	<script type="text/javascript">	jQuery(document).ready(function() {		jQuery('.actionDeliveryOpen').click(function() {			if(!confirm("Sei sicuro di voler chiudere la consegna selezionata?")) {				return false;			}					return true;		});		jQuery('.actionOrderOpen').click(function() {			if(!confirm("Sei sicuro di voler chiudere l'ordine selezionato?")) {				return false;			}					return true;		});			});	</script>	<style type="text/css">	.cakeContainer table.localSelector tr:hover {		background-color: #F9FFCC; 	}	.cakeContainer table.localSelector tr.user-totale:hover {		background-color: #FFFFFF; 	}	.cakeContainer table.localSelector tr.box-user.open {		background-color: #F9FFAA; 	}	.cakeContainer .box-user,	.cakeContainer .box-cart {cursor:pointer;}	</style>	<script type="text/javascript">	jQuery(document).ready(function() {		var delivery_id = jQuery('#delivery_id').val();		if(delivery_id!="" && delivery_id!=undefined) choiceDeliveryCassiere();				jQuery('#delivery_id').change(function() {			choiceDeliveryCassiere();		});	});		</script>	<style type="text/css">	.cakeContainer label {		width: 100px !important;	}	</style><?php}?>